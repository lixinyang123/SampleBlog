<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sample Blog</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css"/>
    <link rel="stylesheet" href="/theme.css"/>

    <script src="https://cdn.jsdelivr.net/npm/marked@1.1.0/marked.min.js"></script>
</head>
<body class="terminal">
    <header>
        <h2 id="name"></h2>
        <div>
            <a href="/">Home</a>
        </div>
    </header>

    <div id="content"></div>

    <script>
        var config = undefined;

        function switchTheme(){
            var time = new Date().getHours();
            if(time > 6 && time < 19){
                document.body.className = "light";
            }
            else{
                document.body.className = "terminal";
            }
        }

        function showArticle(name){
            var href = "/articles/" + name + "/content.txt";
            fetch(href,{
                method:"GET"
            }).then((res)=>{
                if(res.status==200){
                    res.text().then((text)=>{
                        document.getElementById('content').innerHTML = marked(text);
                        var href = "#" + name;
                        history.pushState({page: name},name,href);
                    });
                }
            });
        }

        function showData(){
            document.querySelector("#content").innerHTML = "";
            var articles = config.articles;
            for(var i=0;i<articles.length;i++){
                var article = document.createElement("div");

                var title = document.createElement("h2");
                title.innerText = articles[i].title;

                var time = document.createElement("p");
                time.innerText = articles[i].time;

                var desc = document.createElement("p");
                desc.innerText = articles[i].desc;

                var link = document.createElement("a");
                var btn = document.createElement("button");
                btn.innerText = "Detail";
                btn.setAttribute("onclick","showArticle('" + articles[i].folder + "')");
                link.appendChild(btn);

                var hr = document.createElement("hr");

                article.appendChild(title);
                article.appendChild(time);
                article.appendChild(desc);
                article.appendChild(link);
                article.appendChild(hr);

                document.querySelector("#content").appendChild(article);
            }
        }

        function showConf(){
            var name = config.name + "'s Blog";
            document.querySelector("#name").innerText = name;
            document.querySelector("title").innerText = name;
        }

        function init(){
            window.onpopstate = init;
            switchTheme();

            fetch("/config.json",{
                method:"GET"
            }).then((res)=>{
                res.json().then((body)=>{
                    config = body;
                    showConf();
                    
                    var href = window.location.href;
                    if(href.includes("#")){
                        var article = href.substring(href.indexOf("#")+1);
                        showArticle(article);
                    }
                    else{
                        showData();
                    }
                });
            });
        }

        init();
    </script>

</body>
</html>